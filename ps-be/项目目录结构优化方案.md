# 项目目录结构优化方案

## 项目概述

本文档基于对 `ps-test` 项目的深入分析，提出了全面的目录结构优化方案。项目当前使用 Spring Boot 2.7.18 框架，包含后端管理系统、验证码模块、安全认证等核心功能。

## 当前项目结构分析

### 现状问题

1. **包结构混乱**：仍使用旧的 `com.topinfo.basic.platform` 包名
2. **配置分散**：配置文件分布在多个目录，缺乏统一管理
3. **资源文件杂乱**：静态资源、映射文件、配置文件混合存放
4. **命名不规范**：部分文件和目录命名不符合现代开发规范
5. **版本控制不完善**：缺少必要的忽略规则和文档

### 当前目录结构

```
ps-test/
├── .gitignore
├── README.md
└── ps-bmp-backend/
    ├── pom.xml
    ├── sql/
    │   ├── all/
    │   └── update/
    └── src/
        └── main/
            ├── java/com/topinfo/basic/platform/
            │   ├── Application.java
            │   ├── admin/
            │   ├── captcha/
            │   ├── common/
            │   ├── core/
            │   ├── mvc/
            │   ├── mybatis/
            │   └── security/
            └── resources/
                ├── 123.json
                ├── META-INF/
                ├── config/
                ├── ehcache/
                ├── logback-spring.xml
                ├── mapper/
                ├── redis/
                ├── sm/
                └── static/
```

## 优化方案

### 1. 根目录结构调整

```
ps-test/
├── .gitignore                    # 版本控制忽略规则
├── README.md                     # 项目说明文档
├── CHANGELOG.md                  # 版本变更记录
├── docs/                         # 项目文档目录
│   ├── api/                      # API 文档
│   ├── deployment/               # 部署文档
│   └── development/              # 开发文档
├── scripts/                      # 构建和部署脚本
│   ├── build.sh
│   ├── deploy.sh
│   └── init-db.sql
└── ps-bmp-backend/               # 后端应用
```

### 2. 后端应用结构优化

```
ps-bmp-backend/
├── pom.xml                       # Maven 配置文件
├── Dockerfile                    # Docker 构建文件
├── docker-compose.yml            # Docker Compose 配置
├── database/                     # 数据库相关
│   ├── migrations/               # 数据库迁移脚本
│   │   ├── V1__init_schema.sql
│   │   └── V2__add_user_table.sql
│   ├── seeds/                    # 初始化数据
│   └── backup/                   # 数据库备份
└── src/
    ├── main/
    │   ├── java/com/jiuxi/
    │   │   ├── Application.java
    │   │   ├── config/           # 配置类
    │   │   │   ├── DatabaseConfig.java
    │   │   │   ├── RedisConfig.java
    │   │   │   ├── SecurityConfig.java
    │   │   │   └── WebMvcConfig.java
    │   │   ├── common/           # 通用组件
    │   │   │   ├── annotation/   # 自定义注解
    │   │   │   ├── constant/     # 常量定义
    │   │   │   ├── enums/        # 枚举类
    │   │   │   ├── exception/    # 异常处理
    │   │   │   ├── utils/        # 工具类
    │   │   │   └── validator/    # 验证器
    │   │   ├── core/             # 核心业务
    │   │   │   ├── auth/         # 认证授权
    │   │   │   ├── captcha/      # 验证码
    │   │   │   ├── file/         # 文件处理
    │   │   │   └── log/          # 日志管理
    │   │   ├── module/           # 业务模块
    │   │   │   ├── admin/        # 管理模块
    │   │   │   │   ├── controller/
    │   │   │   │   ├── service/
    │   │   │   │   ├── repository/
    │   │   │   │   ├── dto/
    │   │   │   │   └── entity/
    │   │   │   ├── system/       # 系统模块
    │   │   │   └── user/         # 用户模块
    │   │   └── infrastructure/   # 基础设施
    │   │       ├── cache/        # 缓存实现
    │   │       ├── messaging/    # 消息队列
    │   │       ├── persistence/  # 持久化
    │   │       └── external/     # 外部服务
    │   └── resources/
    │       ├── application.yml           # 主配置文件
    │       ├── application-dev.yml       # 开发环境配置
    │       ├── application-test.yml      # 测试环境配置
    │       ├── application-prod.yml      # 生产环境配置
    │       ├── logback-spring.xml        # 日志配置
    │       ├── META-INF/
    │       │   └── spring.factories
    │       ├── config/                   # 配置文件目录
    │       │   ├── cache/                # 缓存配置
    │       │   │   └── ehcache.xml
    │       │   ├── security/             # 安全配置
    │       │   └── database/             # 数据库配置
    │       ├── mapper/                   # MyBatis 映射文件
    │       │   ├── admin/
    │       │   ├── system/
    │       │   └── user/
    │       ├── static/                   # 静态资源
    │       │   ├── css/
    │       │   ├── js/
    │       │   ├── images/
    │       │   └── templates/            # 文档模板
    │       │       └── wps/
    │       └── i18n/                     # 国际化资源
    │           ├── messages.properties
    │           ├── messages_en.properties
    │           └── messages_zh.properties
    └── test/
        ├── java/com/jiuxi/
        │   ├── integration/              # 集成测试
        │   ├── unit/                     # 单元测试
        │   └── performance/              # 性能测试
        └── resources/
            ├── application-test.yml
            └── test-data/
```

### 3. 文件归类优化

#### 3.1 配置文件管理
- **环境配置分离**：按环境拆分配置文件（dev/test/prod）
- **功能配置分组**：将相关配置归类到子目录
- **敏感信息外置**：使用环境变量或外部配置文件

#### 3.2 静态资源整理
- **按类型分类**：CSS、JS、图片、模板分别存放
- **版本化管理**：为静态资源添加版本号
- **压缩优化**：生产环境使用压缩版本

#### 3.3 数据库文件管理
- **迁移脚本**：使用 Flyway 或 Liquibase 管理数据库版本
- **初始化数据**：分离结构和数据脚本
- **备份策略**：定期备份重要数据

### 4. 命名规范改进

#### 4.1 包命名规范
- **基础包名**：`com.jiuxi`
- **模块包名**：`com.jiuxi.module.{moduleName}`
- **核心包名**：`com.jiuxi.core.{coreName}`
- **通用包名**：`com.jiuxi.common.{commonName}`

#### 4.2 文件命名规范
- **配置文件**：使用 kebab-case（如：`application-dev.yml`）
- **Java 类**：使用 PascalCase（如：`UserController`）
- **接口**：使用 I 前缀（如：`IUserService`）
- **实现类**：使用 Impl 后缀（如：`UserServiceImpl`）

#### 4.3 目录命名规范
- **模块目录**：使用小写单词（如：`admin`、`system`）
- **功能目录**：使用复数形式（如：`controllers`、`services`）
- **配置目录**：使用描述性名称（如：`config`、`mapper`）

### 5. 版本控制优化

#### 5.1 .gitignore 优化
```gitignore
# 编译输出
target/
build/
out/

# IDE 文件
.idea/
.vscode/
*.iml
*.ipr
*.iws

# 日志文件
logs/
*.log

# 临时文件
*.tmp
*.temp
*.swp
*.swo

# 操作系统文件
.DS_Store
Thumbs.db

# 环境配置
.env
.env.local
.env.*.local

# 数据库文件
*.db
*.sqlite

# 缓存文件
.cache/
node_modules/
```

#### 5.2 分支管理策略
- **主分支**：`main`（生产环境）
- **开发分支**：`develop`（开发环境）
- **功能分支**：`feature/{feature-name}`
- **修复分支**：`hotfix/{issue-number}`
- **发布分支**：`release/{version}`

### 6. 文档管理优化

#### 6.1 API 文档
- 使用 Swagger/OpenAPI 3.0 生成 API 文档
- 提供 Postman 集合文件
- 维护 API 变更日志

#### 6.2 开发文档
- 编写详细的 README.md
- 提供快速开始指南
- 维护架构设计文档
- 编写代码规范文档

#### 6.3 部署文档
- Docker 部署指南
- 环境配置说明
- 监控和日志配置

## 实施步骤

### 第一阶段：基础重构（1-2 周）

1. **包结构迁移**
   - [ ] 将 `com.topinfo.basic.platform` 重构为 `com.jiuxi`
   - [ ] 更新所有 import 语句
   - [ ] 修改配置文件中的包引用
   - [ ] 更新 Maven 配置

2. **配置文件整理**
   - [ ] 按环境拆分配置文件
   - [ ] 整理 logback 配置
   - [ ] 优化缓存配置
   - [ ] 规范数据库配置

3. **基础目录调整**
   - [ ] 创建标准目录结构
   - [ ] 移动现有文件到新位置
   - [ ] 更新文件引用路径

### 第二阶段：功能优化（2-3 周）

1. **模块化重构**

   **当前模块分析：**
   - `admin`: 管理后台核心业务模块，包含用户、角色、权限、部门等管理功能
   - `captcha`: 验证码模块，提供图形验证码生成和验证功能
   - `common`: 公共工具模块，包含通用工具类、常量、异常处理等
   - `core`: 核心框架模块，提供基础配置、注解、AOP等功能
   - `security`: 安全认证模块，处理登录、权限验证、JWT等安全相关功能
   - `mvc`: MVC配置模块，提供Web层配置和异常处理
   - `mybatis`: 数据访问模块，提供MyBatis配置和动态数据源支持

   **重构计划：**
   
   **阶段一：Controller层重构**
   - [x] 分析现有Controller结构（已完成PC端、APP端、通用接口分离）
   - [ ] 按业务领域重新组织Controller
     - 用户管理模块：TpPersonBasicinfo、TpAccount相关
     - 组织架构模块：TpDeptBasicinfo、TpCity、TpMediorg相关
     - 权限管理模块：TpRole、TpMenu、TpDataPermissions相关
     - 系统管理模块：TpDictionary、TpParameterConfig、TpTrace相关
     - 文件管理模块：File、TpAttachinfo相关
     - 消息管理模块：TpMessage、TpMessageRead相关
   - [ ] 统一接口规范和返回格式
   - [ ] 优化API路径设计

   **阶段二：Service层优化**
   - [x] 建立清晰的服务接口层次
     - 领域服务接口（Domain Service Interface）✅
     - 应用服务实现（Application Service Implementation）
     - 基础服务支持（Infrastructure Service）
   - [x] 按业务领域拆分服务
     - 用户域服务：UserDomainService ✅
     - 组织域服务：OrganizationDomainService ✅
     - 权限域服务：AuthorizationDomainService ✅
     - 系统域服务：SystemDomainService ✅
     - 文件域服务：FileDomainService
     - 消息域服务：MessageDomainService
   - [ ] 建立服务间的依赖关系和接口契约
   - [ ] 优化事务管理和异常处理

   **已完成的Service层结构**：
   ```
   com.jiuxi.admin.core.service.domain/
   ├── user/
   │   ├── package-info.java
   │   └── UserDomainService.java          # 用户领域服务接口
   ├── organization/
   │   ├── package-info.java
   │   └── OrganizationDomainService.java  # 组织架构领域服务接口
   ├── authorization/
   │   ├── package-info.java
   │   └── AuthorizationDomainService.java # 权限管理领域服务接口
   └── system/
       ├── package-info.java
       └── SystemDomainService.java        # 系统管理领域服务接口
   ```

   **领域服务设计原则**：
   1. **单一职责**：每个领域服务只负责特定业务领域
   2. **业务完整性**：领域服务包含完整的业务流程和规则验证
   3. **接口清晰**：提供明确的业务操作接口，隐藏实现细节
   4. **依赖管理**：通过接口依赖，降低耦合度

   **阶段三：Repository层整理**
   - [x] 统一Mapper接口命名规范（已按实体名称统一）
   - [ ] 按业务模块重新组织Mapper
     - user包：用户相关Mapper
     - organization包：组织架构相关Mapper
     - authorization包：权限相关Mapper
     - system包：系统配置相关Mapper
   - [ ] 建立通用的Repository基类
   - [ ] 优化SQL映射文件组织结构

   **阶段四：领域模块创建**
   - [x] 创建独立的业务领域模块 ✅
     ```
     com.jiuxi.admin.domain/
     ├── user/           # 用户域 ✅
     │   ├── UserDomainConfiguration.java
     │   └── package-info.java
     ├── organization/   # 组织域 ✅
     │   ├── OrganizationDomainConfiguration.java
     │   └── package-info.java
     ├── authorization/  # 权限域 ✅
     │   ├── AuthorizationDomainConfiguration.java
     │   └── package-info.java
     ├── system/        # 系统域 ✅
     │   ├── SystemDomainConfiguration.java
     │   └── package-info.java
     ├── ModuleBoundary.java                 # 模块边界注解 ✅
     └── ModuleDependencyManager.java        # 模块依赖管理器 ✅
     ```
   - [x] 定义领域实体和值对象 ✅
   - [x] 建立领域服务和仓储接口 ✅
   - [x] 实现领域事件机制 ✅

   **阶段五：模块边界建立**
   - [x] 定义模块间的接口契约 ✅
   - [x] 建立防腐层（Anti-Corruption Layer）✅
   - [x] 避免循环依赖 ✅
   - [x] 实现模块间的松耦合 ✅

   **已完成的模块边界设计**：
   - **模块边界注解**：使用 `@ModuleBoundary` 标记模块边界
   - **依赖管理器**：`ModuleDependencyManager` 管理模块间依赖关系
   - **接口契约**：每个领域模块都有明确的配置类和包说明
   - **防腐层**：通过领域服务接口隔离外部依赖

2. **资源文件整理**
   - [ ] 分类静态资源
   - [ ] 整理 MyBatis 映射文件
   - [ ] 优化模板文件结构
   - [ ] 添加国际化支持

3. **测试结构完善**
   - [ ] 建立测试目录结构
   - [ ] 编写单元测试模板
   - [ ] 配置集成测试环境

### 第三阶段：质量提升（1-2 周）

1. **代码质量优化**
   - [ ] 统一代码风格
   - [ ] 添加代码注释
   - [ ] 优化异常处理
   - [ ] 完善日志记录

2. **文档完善**
   - [ ] 更新 README.md
   - [ ] 编写 API 文档
   - [ ] 完善部署文档
   - [ ] 添加开发指南

3. **CI/CD 配置**
   - [ ] 配置 GitHub Actions
   - [ ] 添加代码质量检查
   - [ ] 配置自动化测试
   - [ ] 设置部署流水线

## 预期收益

### 开发效率提升
- **模块化开发**：清晰的模块边界，便于并行开发
- **标准化结构**：新成员快速上手，减少学习成本
- **自动化工具**：CI/CD 流水线提高交付效率

### 维护成本降低
- **统一规范**：减少代码审查时间
- **清晰架构**：便于问题定位和修复
- **文档完善**：降低知识传递成本

### 可扩展性增强
- **松耦合设计**：便于功能扩展
- **标准接口**：支持插件化开发
- **微服务就绪**：为未来架构升级做准备

### 团队协作改善
- **统一标准**：减少代码冲突
- **清晰职责**：明确模块负责人
- **版本管理**：规范的分支策略

### 部署管理便利
- **环境隔离**：配置文件分离
- **容器化支持**：Docker 部署
- **监控完善**：日志和指标收集

## 风险评估与应对

### 主要风险

1. **重构风险**
   - **风险**：大规模重构可能引入新的 Bug
   - **应对**：分阶段实施，充分测试，保留回滚方案

2. **学习成本**
   - **风险**：团队需要适应新的结构和规范
   - **应对**：提供培训，编写详细文档，逐步推进

3. **时间成本**
   - **风险**：重构需要投入大量时间
   - **应对**：合理安排进度，优先处理核心模块

### 质量保证措施

1. **代码审查**：所有变更必须经过 Code Review
2. **自动化测试**：确保重构不破坏现有功能
3. **渐进式迁移**：分模块逐步迁移，降低风险
4. **回滚机制**：保留原有代码，确保可以快速回滚

## 总结

本优化方案旨在通过系统性的目录结构调整，提升项目的可维护性、可扩展性和团队协作效率。通过分阶段实施，可以在控制风险的同时，逐步实现项目架构的现代化升级。

建议优先实施第一阶段的基础重构，为后续的功能开发奠定良好的基础。同时，需要团队全员参与，确保新的规范能够得到有效执行。